#!/bin/bash
# Usage: source this file or add to your shell profile:
#   work() { source /path/to/bin/work "$@"; }
#
# Then: work hogehoge
#   -> creates worktree at .worktrees/YYYYMMDD-HHMMSS-hogehoge and cd into it

set -euo pipefail

if [ $# -eq 0 ]; then
    echo "Usage: work <name>" >&2
    return 1 2>/dev/null || exit 1
fi

NAME="$1"
REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
TIMESTAMP="$(date +%Y%m%d-%H%M%S)"
BRANCH_NAME="${TIMESTAMP}-${NAME}"
WORKTREE_DIR="${REPO_ROOT}/.worktrees/${BRANCH_NAME}"

git -C "$REPO_ROOT" worktree add -b "$BRANCH_NAME" "$WORKTREE_DIR" main

echo "Created worktree: $WORKTREE_DIR"
